<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title id="siteTitle">Retro & MMORPG Podcast</title>

  <style>
    /* ========== Base / Layout ========== */
    :root{
      --ink:#0b0b0b; --fg:#fff; --mut:#ffffffb3; --line:#ffffff1a; --brand:#fa8072;
      --header-h:64px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--ink);color:var(--fg);
      font:16px/1.55 system-ui,-apple-system,Segoe UI,Inter,Helvetica,Arial}
    a{color:var(--brand);text-decoration:none}
    .wrap{max-width:1120px;margin:0 auto;padding:0 20px}
    .hide{display:none}

    /* ========== Header (fixed) ========== */
    .header{
      position:fixed; inset:0 0 auto 0; height:var(--header-h);
      background:#0b0b0bcc; backdrop-filter:saturate(140%) blur(6px);
      border-bottom:1px solid var(--line); z-index:1000;
    }
    .nav{display:flex;align-items:center;justify-content:space-between;height:100%}
    .brand{display:flex;align-items:center;gap:12px;color:var(--fg);text-decoration:none}
    .brand-badge{display:inline-flex;width:36px;height:36px;align-items:center;justify-content:center;border-radius:12px;background:var(--brand);color:#000;font-weight:800}
    .brand-title{font-weight:800;letter-spacing:.2px}
    .desk-nav{display:flex;gap:18px}
    .desk-nav a{color:var(--fg);opacity:.95;text-decoration:none}
    .desk-nav a:hover{color:#ffd0c9}
    .menu-btn{
      display:none;min-width:40px;height:40px;border-radius:10px;
      border:1px solid #ffffff26;background:#0000;color:var(--fg);
      font-size:18px;cursor:pointer
    }
    @media (max-width:900px){
      .desk-nav{display:none}
      .menu-btn{display:inline-flex;align-items:center;justify-content:center}
    }

    /* ========== Modern Mobile Menu (drawer + backdrop) ========== */
    .drawer-backdrop{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.55);
      opacity: 0;
      pointer-events: none;
      transition: opacity .25s ease;
      z-index: 11000;
    }
    .drawer-backdrop.open{opacity: 1;pointer-events:auto;}

    .drawer{
      position: fixed;
      top: 0; right: 0; bottom: 0;
      width: min(86vw, 380px);
      background: #000;
      border-left: 1px solid #1f1f1f;
      transform: translateX(100%);
      transition: transform .28s ease;
      z-index: 11001;
      display: flex; flex-direction: column;
      -webkit-overflow-scrolling: touch;
    }
    .drawer.open{transform: translateX(0);}

    .drawer-head{
      display:flex;align-items:center;justify-content:space-between;
      padding:16px;border-bottom:1px solid #1f1f1f;
    }
    .drawer-title{font-weight:700}
    .drawer-close{
      width:44px;height:44px;border-radius:12px;border:1px solid #222;
      background:#111;color:#fff;font-size:24px;line-height:1;cursor:pointer;
      display:inline-flex;align-items:center;justify-content:center;
    }
    .drawer-links{
      padding:16px;display:flex;flex-direction:column;gap:12px;overflow:auto;height:100%;
    }
    .drawer-links a{
      display:block;padding:14px 16px;font-size:18px;
      background:#121212;border:1px solid #1f1f1f;color:#fff;
      border-radius:12px;text-decoration:none;
    }
    .drawer-links a:active{transform:translateY(1px)}

    /* ========== Sections (full screen below header) ========== */
    main{padding-top:var(--header-h)}
    .section{
      min-height:100svh;
      display:flex;align-items:center;position:relative;
      padding: clamp(28px, 6vh, 96px) 0;
      border-top:1px solid var(--line);
    }
    @supports(height:100dvh){.section{min-height:100dvh}}
    .section.alt{background:#ffffff0d;border-bottom:1px solid var(--line)}
    .section-inner{width:100%}
    .split-head{display:flex;gap:12px;align-items:end;justify-content:space-between;flex-wrap:wrap}

    /* ========== Hero ========== */
    .hero{position:relative}
    .hero h1{font-size:40px;margin:0}
    .accent{color:var(--brand)}
    .hero-bg{position:absolute;inset:0;z-index:-1;opacity:.22;
      background:radial-gradient(45rem 45rem at 50% -10%, #fa807266, transparent 70%);
      filter:blur(2px)}
    .mut{color:var(--mut)} .mut.sm{font-size:14px} .mut.xs{font-size:12px}
    .maxw{max-width:58ch}
    .row.gap{display:flex;gap:12px;flex-wrap:wrap;margin-top:8px}

    /* ========== Buttons ========== */
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;
      padding:10px 16px;border-radius:12px;border:1px solid var(--line);
      color:var(--fg);cursor:pointer}
    .btn-primary{background:var(--brand);color:#000;border-color:transparent;font-weight:700}
    .btn-ghost{background:transparent}

    /* ========== Cards ========== */
    .cards{display:grid;gap:16px;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));margin-top:18px}
    .card{border:1px solid var(--line);background:#ffffff0d;border-radius:16px;
      overflow:hidden;transition:transform .25s ease,background .25s ease}
    .card:hover{transform:translateY(-2px)}
    .card-img{aspect-ratio:16/9;background:linear-gradient(135deg,#ffffff26,#ffffff0d)}
    .card-body{padding:14px}

    /* ========== Spotify player (no aspect-ratio gap) ========== */
    .spotify-frame iframe{
      width:100%; height:152px;
      border:0; border-radius:12px; display:block;
    }

    /* ========== Footer ========== */
    .footer{padding:24px 0;border-top:1px solid var(--line)}
    .foot{display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;color:#ffffff99}
    .foot-links a{color:#ffffffcc}

    /* ========== Bullets ========== */
    .bullets{margin-top:12px;padding-left:18px;color:var(--mut)}
  </style>
</head>
<body>
  <!-- Fixed header -->
  <header class="header" role="banner">
    <div class="wrap nav">
      <a href="#top" class="brand" aria-label="Home">
        <span class="brand-badge">▶</span>
        <span class="brand-title" id="brandTitle">Retro & MMORPG Podcast</span>
      </a>

      <!-- Desktop nav (static) -->
      <nav class="desk-nav" aria-label="Primary">
        <a class="nav-link" href="#about">About</a>
        <a class="nav-link" href="#podcast">Listen</a>
        <a class="nav-link" href="#episodes">Episodes</a>
        <a class="nav-link" href="#retro">Retro</a>
        <a class="nav-link" href="#featured">Featured</a>
        <a class="nav-link" href="#contact">Contact</a>
      </nav>

      <!-- Mobile toggle -->
      <button id="menuBtn" class="menu-btn" aria-controls="mobileDrawer" aria-expanded="false" aria-label="Open menu">☰</button>
    </div>

    <!-- Mobile: backdrop + slide-in drawer -->
    <div id="drawerBackdrop" class="drawer-backdrop" hidden></div>

    <aside id="mobileDrawer" class="drawer" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Site menu">
      <div class="drawer-head">
        <div class="drawer-title">Menu</div>
        <button id="drawerClose" class="drawer-close" aria-label="Close menu">×</button>
      </div>
      <nav class="drawer-links">
        <a href="#about">About</a>
        <a href="#podcast">Listen</a>
        <a href="#episodes">Episodes</a>
        <a href="#retro">Retro</a>
        <a href="#featured">Featured</a>
        <a href="#contact">Contact</a>
      </nav>
    </aside>
  </header>

  <main>
    <!-- Full-screen sections -->
    <section id="top" class="section hero">
      <div class="wrap section-inner">
        <h1 id="heroTitle">Loading…</h1>
        <p class="mut" id="heroSubtitle"></p>
        <div class="row gap">
          <a href="#podcast" class="btn btn-primary" id="ctaPrimary">Listen now</a>
          <a href="#episodes" class="btn btn-ghost" id="ctaSecondary">Browse episodes</a>
        </div>
      </div>
      <div class="hero-bg" aria-hidden="true"></div>
    </section>

    <section id="about" class="section">
      <div class="wrap section-inner">
        <h2 id="aboutHeading">About</h2>
        <p class="mut maxw" id="aboutCopy"></p>
        <ul class="bullets" id="aboutBullets"></ul>
      </div>
    </section>

    <!-- LISTEN: hard-coded Spotify show embed -->
    <section id="podcast" class="section alt">
      <div class="wrap section-inner">
        <h2 id="listenHeading">Listen</h2>
        <div class="spotify-frame">
          <iframe
            src="https://open.spotify.com/embed/show/5tFabzKjFj7usbKFjVXMfp"
            allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
            loading="lazy">
          </iframe>
        </div>
      </div>
    </section>

    <section id="episodes" class="section">
      <div class="wrap section-inner">
        <div class="split-head">
          <h2 id="episodesHeading">Latest episodes</h2>
          <a id="subscribeLink" class="link hide" href="#" rel="noopener">Subscribe →</a>
        </div>
        <div id="episodesGrid" class="cards"></div>
      </div>
    </section>

    <section id="retro" class="section alt">
      <div class="wrap section-inner">
        <h2 id="retroHeading">Retro spotlights</h2>
        <div id="retroGrid" class="cards"></div>
      </div>
    </section>

    <section id="featured" class="section">
      <div class="wrap section-inner">
        <h2 id="featuredHeading">Featured</h2>
        <div id="featuredGrid" class="cards"></div>
      </div>
    </section>

    <section id="contact" class="section alt">
      <div class="wrap section-inner">
        <h2 id="contactHeading">Contact</h2>
        <div id="contactBody"></div>
      </div>
    </section>

    <footer class="footer">
      <div class="wrap foot">
        <div>© <span id="year"></span> <span id="footerBrand">Podcast</span></div>
        <div class="foot-links"><a href="#top">Back to top</a></div>
      </div>
    </footer>
  </main>

  <script>
    (function () {
      'use strict';
      const $ = (id) => document.getElementById(id);
      const setHTML = (el, html) => { if (el) el.innerHTML = html; };
      const setText = (el, txt) => { if (el) el.textContent = txt; };

      document.addEventListener('DOMContentLoaded', () => {
        /* ---------- Year ---------- */
        const yearEl = $('year');
        if (yearEl) yearEl.textContent = new Date().getFullYear();

        /* ---------- Mobile drawer menu ---------- */
        const btn = $('menuBtn');
        const drawer = $('mobileDrawer');
        const closeBtn = $('drawerClose');
        const backdrop = $('drawerBackdrop');

        const firstLink = () => drawer?.querySelector('.drawer-links a');

        function openDrawer() {
          drawer.classList.add('open');
          drawer.setAttribute('aria-hidden', 'false');
          btn.setAttribute('aria-expanded', 'true');
          backdrop.hidden = false;
          backdrop.classList.add('open');
          document.body.style.overflow = 'hidden';     // lock background scroll
          setTimeout(() => firstLink()?.focus(), 0);   // focus first link
        }
        function closeDrawer() {
          drawer.classList.remove('open');
          drawer.setAttribute('aria-hidden', 'true');
          btn.setAttribute('aria-expanded', 'false');
          backdrop.classList.remove('open');
          setTimeout(() => { backdrop.hidden = true; }, 250);
          document.body.style.overflow = '';
          btn.focus({preventScroll:true});
        }

        btn?.addEventListener('click', () => {
          drawer.classList.contains('open') ? closeDrawer() : openDrawer();
        });
        closeBtn?.addEventListener('click', closeDrawer);
        backdrop?.addEventListener('click', closeDrawer);
        drawer?.addEventListener('click', (e) => {
          if (e.target.matches('.drawer-links a')) closeDrawer();
        });
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') closeDrawer();
        });
        window.addEventListener('hashchange', closeDrawer);

        /* ---------- Content from content.json (no fallback) ---------- */
        const el = {
          siteTitle: $('siteTitle'), brandTitle: $('brandTitle'), footerBrand: $('footerBrand'),
          heroTitle: $('heroTitle'), heroSubtitle: $('heroSubtitle'),
          ctaPrimary: $('ctaPrimary'), ctaSecondary: $('ctaSecondary'),
          aboutHeading: $('aboutHeading'), aboutCopy: $('aboutCopy'), aboutBullets: $('aboutBullets'),
          listenHeading: $('listenHeading'),
          episodesHeading: $('episodesHeading'), retroHeading: $('retroHeading'),
          featuredHeading: $('featuredHeading'), contactHeading: $('contactHeading'), contactBody: $('contactBody'),
          episodesGrid: $('episodesGrid'), retroGrid: $('retroGrid'), featuredGrid: $('featuredGrid'),
          subscribeLink: $('subscribeLink')
        };

        function episodeCard(e) {
          return `
            <article class="card" data-episode-id="${e.id}">
              <div class="card-img"></div>
              <div class="card-body">
                <strong>${e.title || ''}</strong>
                ${e.description ? `<div class="mut sm" style="margin-top:6px">${e.description}</div>` : ''}
                ${e.duration ? `<div class="mut xs" style="margin-top:6px">${e.duration}</div>` : ''}
              </div>
            </article>`;
        }
        function retroCard(r) {
          const url = r.url || '#';
          const target = r.target || (String(url).startsWith('http') ? '_blank' : '_self');
          return `
            <a class="card" href="${url}" target="${target}" rel="noopener">
              <div class="card-img"></div>
              <div class="card-body">
                <strong>${r.title || ''}</strong>
                ${r.blurb ? `<div class="mut sm" style="margin-top:6px">${r.blurb}</div>` : ''}
              </div>
            </a>`;
        }
        function featuredCard(f) {
          const inner = `
            <div class="card-img"></div>
            <div class="card-body">
              <strong>${f.title || ''}</strong>
              ${f.subtitle ? `<div class="mut xs" style="margin-top:6px">${f.subtitle}</div>` : ''}
              ${f.description ? `<div class="mut sm" style="margin-top:6px">${f.description}</div>` : ''}
            </div>`;
          if (f.type === 'episode') return `<div class="card" data-episode-id="${f.episodeId}">${inner}</div>`;
          const url = f.url || '#';
          const target = f.target || (String(url).startsWith('http') ? '_blank' : '_self');
          return `<a class="card" href="${url}" target="${target}" rel="noopener">${inner}</a>`;
        }

        function installEpisodeClicks(data) {
          document.querySelectorAll('[data-episode-id]').forEach(card => {
            card.addEventListener('click', () => {
              const id = card.getAttribute('data-episode-id');
              const e = (data.episodes || []).find(x => String(x.id) === String(id));
              if (!e) return;
              if (e.link)         window.open(e.link, '_blank');
              else if (e.embedUrl) window.open(e.embedUrl, '_blank');
              else if (e.audioUrl) window.open(e.audioUrl, '_blank');
            });
          });
        }

        async function loadJSON() {
          const res = await fetch('content.json?v=' + Date.now(), { cache: 'no-store' });
          if (!res.ok) throw new Error('content.json not found (HTTP ' + res.status + ')');
          return await res.json();
        }

        (async () => {
          const data = await loadJSON();

          // Meta / brand
          setText(el.siteTitle,   data.meta?.title || 'Podcast');
          setText(el.brandTitle,  data.meta?.brand || data.meta?.title || 'Podcast');
          setText(el.footerBrand, data.meta?.brand || data.meta?.title || 'Podcast');

          // Hero
          setHTML(el.heroTitle, data.hero?.title || '');
          setText(el.heroSubtitle, data.hero?.subtitle || '');
          setText(el.ctaPrimary, data.hero?.ctaPrimary?.label || 'Listen now');
          if (data.hero?.ctaPrimary?.href) el.ctaPrimary.href = data.hero.ctaPrimary.href;
          setText(el.ctaSecondary, data.hero?.ctaSecondary?.label || 'Browse episodes');
          if (data.hero?.ctaSecondary?.href) el.ctaSecondary.href = data.hero.ctaSecondary.href;

          // About
          setText(el.aboutHeading, data.about?.heading || 'About');
          setText(el.aboutCopy,    data.about?.copy || '');
          setHTML(el.aboutBullets, (data.about?.bullets || []).map(b => `<li>${b}</li>`).join(''));

          // Section headings & contact
          setText(el.listenHeading,   data.listen?.heading || 'Listen');
          setText(el.episodesHeading, data.episodesHeading || 'Latest episodes');
          setText(el.retroHeading,    data.retroHeading    || 'Retro spotlights');
          setText(el.featuredHeading, data.featuredHeading || 'Featured');
          setText(el.contactHeading,  data.contact?.heading || 'Contact');
          setHTML(el.contactBody,     data.contact?.html || '');

          // Subscribe link
          if (data.meta?.subscribeUrl && el.subscribeLink) {
            el.subscribeLink.href = data.meta.subscribeUrl;
            el.subscribeLink.classList.remove('hide');
          }

          // Grids
          if (el.episodesGrid) el.episodesGrid.innerHTML = (data.episodes || []).map(episodeCard).join('');
          if (el.retroGrid)    el.retroGrid.innerHTML    = (data.retro || []).map(retroCard).join('');
          if (el.featuredGrid) el.featuredGrid.innerHTML = (data.featured || []).map(featuredCard).join('');

          installEpisodeClicks(data);
        })().catch(err => console.error(err)); // no fallback
      });
    })();
  </script>
</body>
</html>
